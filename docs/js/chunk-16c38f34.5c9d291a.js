(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16c38f34"],{3846:function(e,t,a){a("9e1e")&&"g"!=/./g.flags&&a("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:a("0bfb")})},"4b04":function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return r});a("6b54"),a("ac6a");var i=a("d4ec"),n=a("bee2"),c=a("8bc4"),r=function(){function t(){Object(i["a"])(this,t),this.client=new c["a"]}return Object(n["a"])(t,[{key:"getFireAlarmDeviceData",value:function(e,t){return this.client.queryDevicePropertiesData({ProductKey:e,DeviceName:t,"Identifier.1":"CurrentTemperature","Identifier.2":"SmokeSensorState","Identifier.3":"PowerSwitch",StartTime:Date.now(),EndTime:Date.now()-6e4,PageSize:1,Asc:0}).then(function(e){if(void 0==e)return null;var t=e.data,a={temperature:0,smokeAlarm:!1,switch:!1};return t.Success&&t.PropertyDataInfos.PropertyDataInfo.forEach(function(e,t){switch(e.Identifier){case"CurrentTemperature":a.temperature=parseFloat(e.List.PropertyInfo[0].Value);break;case"SmokeSensorState":a.smokeAlarm=1==e.List.PropertyInfo[0].Value;break;case"PowerSwitch":a.switch=1==e.List.PropertyInfo[0].Value;break;default:break}}),a}).catch(function(e){console.error(e)})}},{key:"getDeviceStatus",value:function(e,t){return this.client.getDeviceStatus({ProductKey:e,DeviceName:t}).then(function(e){return e.data.Success?e.data.Data.Status:"Error"}).catch(function(e){console.error(e)})}},{key:"setSwitch",value:function(t,a,i){var n={id:Math.floor(99901*Math.random()+100),version:"1.0",params:{PowerSwitch:i},method:"thing.service.property.set"};return this.client.pub({ProductKey:t,TopicFullName:"/sys/".concat(t,"/").concat(a,"/thing/service/property/set"),MessageContent:new e(JSON.stringify(n)).toString("base64")})}}]),t}()}).call(this,a("b639").Buffer)},"6b54":function(e,t,a){"use strict";a("3846");var i=a("cb7c"),n=a("0bfb"),c=a("9e1e"),r="toString",o=/./[r],s=function(e){a("2aba")(RegExp.prototype,r,e,!0)};a("79e5")(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?s(function(){var e=i(this);return"/".concat(e.source,"/","flags"in e?e.flags:!c&&e instanceof RegExp?n.call(e):void 0)}):o.name!=r&&s(function(){return o.call(this)})},"85a6":function(e,t,a){},"9ea8":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("mt-header",{attrs:{title:"DeviceName: "+e.deviceName}},[a("router-link",{attrs:{slot:"left",to:"/"},slot:"left"},[a("mt-button",{attrs:{icon:"back"}},[e._v("返回")])],1)],1),a("mt-cell",{attrs:{title:"连接状态",value:e.deviceData.online?"在线":"离线"}}),a("mt-cell",{attrs:{title:"当前温度",value:e.deviceData.temperature.toFixed(2)}}),a("mt-cell",{attrs:{title:"烟感告警",value:e.deviceData.smokeAlarm?"有告警":"正常"}}),a("mt-cell",{attrs:{title:"开关状态",value:e.deviceData.switch?"开":"关"}}),a("div",{staticClass:"page-actionsheet-wrapper"},[a("p",[e._v(" ")]),a("p",[e._v(" ")]),a("p",[e._v(" ")]),a("mt-button",{attrs:{type:"primary",plain:"",size:"large"},nativeOn:{click:function(t){e.sheetVisible=!0}}},[e._v("设置开关状态")])],1),a("mt-actionsheet",{attrs:{actions:e.actions},model:{value:e.sheetVisible,callback:function(t){e.sheetVisible=t},expression:"sheetVisible"}})],1)},n=[],c=(a("cadf"),a("551c"),a("097d"),a("4b04")),r=new c["a"],o={name:"device",data:function(){return{productKey:"",deviceName:"",deviceData:{online:!1,temperature:0,smokeAlarm:!1,switch:!1},switchValue:!1,sheetVisible:!1,actions:[]}},beforeMount:function(){var e=this;this.actions=[{name:"开",method:this.switchOn},{name:"关",method:this.switchOff}],this.deviceName=this.$route.params.dn,this.productKey=this.$route.params.pk,setInterval(function(){e.refresh(e.productKey,e.deviceName)},1e3)},watch:{},methods:{setSwitch:function(e){r.setSwitch(this.productKey,this.deviceName,e?1:0).then(function(e){if(void 0!=e){var t=e.data;t.Success||console.error("SetSwitch fail: ",t.ErrorMessage)}}).catch(function(e){console.error("onSetSwitch error: %s",e)})},refresh:function(e,t){var a=this;r.getDeviceStatus(e,t).then(function(e){a.deviceData.online="ONLINE"===e}),r.getFireAlarmDeviceData(e,t).then(function(e){a.deviceData.temperature=e.temperature,a.deviceData.smokeAlarm=e.smokeAlarm,a.deviceData.switch=e.switch})},switchOn:function(){console.log("switchOn"),this.setSwitch(!0)},switchOff:function(){console.log("switchOff"),this.setSwitch(!1)}},components:{}},s=o,u=(a("deb0"),a("2877")),l=Object(u["a"])(s,i,n,!1,null,"aaa2ccf2",null);l.options.__file="DeviceConsole.m.vue";t["default"]=l.exports},deb0:function(e,t,a){"use strict";var i=a("85a6"),n=a.n(i);n.a}}]);
//# sourceMappingURL=chunk-16c38f34.5c9d291a.js.map